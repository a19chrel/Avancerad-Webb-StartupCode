<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>React Startup Code</title>
    <link rel="stylesheet" href="weatherApp.css">
</head>
<body>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>

<form action="Startup.html" method="get">
    <div class="form-group search">
        <input type="text" class="input" placeholder="search" name="ort">
        <button type="submit"><img src='magnify.svg'></button>
    </div>
</form>

<div id="content">

</div>

<script type="text/babel">

    // React since react V4 does not read query parameters so we read query parameter directly
    const urlParams = new URLSearchParams(window.location.search);
    const ort = urlParams.get('ort');

    if (ort != null) alert(ort);

    //Content element
    class App extends React.Component {
        constructor(props) {
            super(props);
        }

        render() {
            return (
                <div>
                    <Info data={this.props.info}></Info>
                    <ForecastList data={this.props.forecastArr}></ForecastList>
                    <Chat comments={this.props.comments}></Chat>
                </div>
            );
        }
    }

    class Info extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                infoHidden: false,
            };

            this.handleClick = this.handleClick.bind(this)
        }

        handleClick = () => {
            this.setState({
                infoHidden: !this.state.infoHidden
            })
        };

        render() {
            if (this.state.infoHidden){
                return (
                    <div className="info-box container">
                        <h2><a onClick={this.handleClick}>{this.props.data.name} (click to hide)</a></h2>
                    </div>

                );
            }else {
                return (
                    <div className="info-box container">
                        <h2><a onClick={this.handleClick}>{this.props.data.name} (click to hide)</a></h2>
                        <div className=" flex space-between">
                            <div>
                                <p>{this.props.data.province}, {this.props.data.country}</p>
                                <p>{this.props.data.geolocation.LATITUDE}° N, {this.props.data.geolocation.LONGITUDE}° E</p>
                                <p className="mt-20">
                                    <strong>Postalcode: </strong>
                                    {this.props.data.postalcode}
                                </p>
                                <p>
                                    <strong>Climatecode: </strong>
                                    {this.props.data.climatecode}
                                </p>
                                <p>
                                    <strong>Areacode: </strong>
                                    {this.props.data.areacode}
                                </p>
                            </div>
                            <div>
                                <p>{this.props.data.about}</p>
                            </div>
                        </div>
                    </div>

                );
            }

        }
    }

    class ForecastList extends React.Component {
        constructor(props) {
            super(props);
        }

        render() {
            const list = this.props.data.map((obj, index) =>
                <ForecastListRow key={index} data={obj}></ForecastListRow>
            );
            return (
                <div className="forecast container">
                    <ForecastListHeader></ForecastListHeader>
                    <div>{list}</div>
                </div>

            );
        }
    }

    class ForecastListHeader extends React.Component {
        constructor(props) {
            super(props);
        }

        render() {

            return (
                <div className="flex forecast-row">
                    <div>Date</div>
                    <div>Temp</div>
                    <div>Downfall</div>
                    <div>Wind</div>
                    <div>Airpressure</div>
                </div>
            );
        }
    }

    class ForecastListRow extends React.Component {
        constructor(props) {
            super(props);
        }

        render() {
            return (
                <div className="flex forecast-row">
                    <div>
                        <p>{this.props.data["startdate"].split(" ")[0]}</p>
                        <p>{this.props.data["startdate"].split(" ")[1]} - {this.props.data["enddate"].split(" ")[1]}</p>
                    </div>
                    <div><p>{this.props.data["temp"]} {this.props.data["tempUnit"]}</p></div>
                    <div>
                        <p>{this.props.data["downfalltype"]}</p>
                        <p>{this.props.data["downfallAmount"]} {this.props.data["downfallUnit"]}</p>
                    </div>
                    <div>
                        <p>{this.props.data["windDirection"]}</p>
                        <p>{this.props.data["MPS"]} MPS</p>
                    </div>
                    <div>
                        <p>{this.props.data["airpressureValue"]} {this.props.data["airpressureUnit"]}</p>
                    </div>
                </div>
            );
        }
    }

    class Chat extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                hideChat: true,
            };

            this.handleClick = this.handleClick.bind(this)
        }

        handleClick = () => {
            this.setState({
                hideChat: !this.state.hideChat
            })
        };

        render() {
            const commentList = this.props.comments.map((obj, index) =>
                <Comment key={index}>
                    <h4>{obj.user}</h4>
                    <p>Likes: {obj.likes} <a href="#">Like</a></p>
                    <p>{obj.message}</p>
                </Comment>
            );

            if (this.state.hideChat){
                return (
                    <div className="comment-button">
                        <a onClick={this.handleClick}>Comments</a>
                    </div>

                );
            }else {
                return (<div className="comment-window">
                        <div className="comment-header">
                            <h3>Comments ({commentList.length})</h3>
                            <a onClick={this.handleClick}>Close</a>
                        </div>
                        <div className="comment-content">
                            {commentList}
                        </div>
                        <textarea className="comment-input" placeholder="Write your comment here.."></textarea>
                    </div>

                );
            }

        }
    }

    class Comment extends React.Component {
        constructor(props) {
            super(props);
        }

        render() {
            return (
                <div key="index">
                    {this.props.children}
                </div>
            );
        }
    }

    const forecastArr = [
        {
            name: "Halmstad",
            startdate: "2020-01-01 00:00:00",
            enddate: "2020-01-01 06:00:00",
            periodnr: 0,
            periodname: "Night",
            temp: 2,
            tempUnit: "Celcius",
            downfalltype: "Snowing",
            downfallAmount: 30,
            downfallUnit: "mm",
            windDirection: "South-East",
            MPS: 5.1,
            airpressureValue: 1259,
            airpressureUnit: "hPa"
        },
        {
            name: "Halmstad",
            startdate: "2020-01-01 00:00:00",
            enddate: "2020-01-01 06:00:00",
            periodnr: 0,
            periodname: "Night",
            temp: 2,
            tempUnit: "Celcius",
            downfalltype: "Snowing",
            downfallAmount: 30,
            downfallUnit: "mm",
            windDirection: "South-East",
            MPS: 5.1,
            airpressureValue: 1259,
            airpressureUnit: "hPa"
        },
        {
            name: "Halmstad",
            startdate: "2020-01-01 00:00:00",
            enddate: "2020-01-01 06:00:00",
            periodnr: 0,
            periodname: "Night",
            temp: 2,
            tempUnit: "Celcius",
            downfalltype: "Snowing",
            downfallAmount: 30,
            downfallUnit: "mm",
            windDirection: "South-East",
            MPS: 5.1,
            airpressureValue: 1259,
            airpressureUnit: "hPa"
        },
    ]
    const info = {
        name: "Halmstad",
        type: "Regional capital",
        country: "Sweden",
        geolocation: {
            ALTITUDE: "11",
            LATITUDE: "56.67446",
            LONGITUDE: "12.85676",
            GEOBASE: "geonames",
            GEOBASEID: "2708365"
        },
        about: "Halmstad, at the time part of the Kingdom of Denmark, received its first city charter in 1307, and the city celebrated its 700th anniversary in 2007. The oldest remains of that first town are to be found at Ovraby upstream on Nissan, just south of and quite close to the present day regiment buildings. The remains of the church can still be seen today between a defunct brick industry and a former landfill.In the 1320s the town moved to the present day town centre. At this time there were two monasteries in the town and during the 15th century the St. Nikolai church was built. Halland was the object of numerous battles, sieges and occupations by Swedish troops.",
        climatecode: "Dfb",
        climate: "Halmstad has the south Scandinavian variety of the relatively wet humid continental climate (Dfb) with warm summers and cold winters, closely bordering on an oceanic climate (Cfb).",
        province: "Halland",
        municipality: "Halmstad Municipality",
        postalcode: "30x xx",
        areacode: "(+46) 35"
    }
    const comments = [
        {user: "Bengt", likes: 17, message: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."},
        {user: "Berit", likes: 3, message: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."},
        {user: "Greger", likes: 32, message: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."},
        {user: "Karin", likes: 2, message: "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."}
    ]

    ReactDOM.render(
        <App forecastArr={forecastArr} info={info} comments={comments}/>,
        document.getElementById('content')
    );
</script>
</body>
</html>